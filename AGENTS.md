# 智能体提示词最佳实践指南

本文档定义了 NewsAgent 项目中所有智能体提示词的编写规范和最佳实践。

---

## 核心原则

### 1. 简洁明了

**目标**：让智能体能快速理解任务，避免信息过载。

**实践**：

- ✅ 总行数控制在 100-200 行
- ✅ 每个部分只包含核心信息
- ❌ 避免冗长的代码示例
- ❌ 避免重复的场景说明

**示例**：

```markdown
## 工作流程

1. 搜索新闻
2. 并行处理链接
3. 聚合为事件
4. 生成报告
```

而不是：

```markdown
## 工作流程

### 详细步骤说明

#### 步骤1：搜索新闻的详细说明

在这个步骤中，你需要使用以下工具...（200字说明）

#### 步骤2：处理链接的详细说明

这里有三种可能的场景...（300字说明）
```

---

### 2. 使用模板引用

**目标**：避免重复定义共用结构。

**实践**：

- ✅ 将共用结构放在 `templates/` 目录
- ✅ 在提示词中使用 `@filename` 语法引用模板文件
- ✅ 只说明填充规则，不重复模板内容
- ❌ 不要在多个提示词中重复定义相同结构

**项目模板**：

```
templates/
├── event-report-template.md      # 最终报告模板
├── total-index-template.md       # 总索引模板
├── category-index-template.md    # 类别索引模板
└── sections/                     # 各部分模板
    ├── summary-section-template.md
    ├── news-section-template.md
    ├── validation-section-template.md
    ├── timeline-section-template.md
    ├── prediction-section-template.md
    └── images-section-template.md
```

**引用语法**（OpenCode 文件引用）：

使用 `@` 前缀引用模板文件，内容会自动包含在 prompt 中：

```markdown
## 报告格式

参考模板：`@templates/sections/validation-section-template.md`

模板内容会自动包含在 prompt 中，请严格遵守其格式要求。

### 填充规则

模板中的 `{placeholder}` 需填充为：
- 填充格式说明
- 关键要求
```

**关键原则**：

1. **模板中已有的内容** → 只引用，不重复
   - 整体结构（## 标题、--- 分隔符等）
   - 占位符（`{variable}`）

2. **模板中没有的内容** → 需要说明
   - 填充格式（如何填充占位符）
   - 数据映射（从数据库字段到模板）
   - 特殊规则（排序、过滤等）

**对比示例**：

❌ **不好** - 重复模板内容：

```markdown
## 报告格式

```markdown
## 可信度评分

**综合评分**：{score}/100

---

## 证据链验证

{evidence}

---

## 结论

{conclusion}
```

✅ **好** - 引用模板并说明填充规则：

```markdown
## 报告格式

参考模板：`@templates/sections/validation-section-template.md`

模板内容会自动包含在 prompt 中，请严格遵守其格式要求。

### 证据链填充格式

每个证据链步骤需包含：
- 验证焦点和核心结论
- 支撑来源（至少1个）
- 交叉验证结果
```

---

### 3. 明确职责和边界

**目标**：让智能体清楚知道要做什么、不要做什么。

**实践**：

- ✅ 清晰定义输入和输出
- ✅ 列出可用工具
- ✅ 说明关键约束和禁止事项
- ❌ 不要留下模糊的指令

**标准结构**：

```markdown
## 核心职责

1. 职责1（一句话描述）
2. 职责2（一句话描述）
3. 职责3（一句话描述）

## 输入参数

从 prompt 中提取：

- param1: 说明
- param2: 说明

## 输出要求

返回JSON包含：

- field1: 说明
- field2: 说明

## 可用工具

- `tool_name` - 简短说明
- `@agent_name` - 简短说明
```

---

### 4. 聚焦"做什么"而非"怎么做"

**目标**：让智能体推理最佳实现方式。

**实践**：

- ✅ 描述目标和期望结果
- ❌ 不要提供详细的实现代码
- ❌ 不要规定具体的实现步骤

**示例对比**：

❌ **不好** - 过度详细：

````markdown
### 如何提取图片文件名

使用以下正则表达式：

```python
pattern = r'/([^/]+\.(jpg|jpeg|png|gif|webp))$'
match = re.search(pattern, image_path)
if match:
    return match.group(1)
```
````

然后使用这个函数处理每个路径...

````

✅ **好** - 清晰简洁：

```markdown
### 修正图片路径

- 从路径中提取文件名
- 改为相对路径：`./{event_name}/{filename}`
- 验证文件是否存在
````

---

### 5. 减少代码示例

**目标**：智能体能理解自然语言指令，不需要大量代码。

**实践**：

- ✅ 使用简洁的配置示例
- ✅ 使用 JSON 结构说明数据格式
- ❌ 避免完整的 Python 脚本
- ❌ 避免冗长的命令示例

**代码示例使用场景**：

| 场景     | 是否需要代码 | 示例类型                      |
| -------- | ------------ | ----------------------------- |
| 工具调用 | ✅ 简短示例  | `tool_name(arg1, arg2)`       |
| 数据格式 | ✅ 结构说明  | JSON 结构                     |
| 文件路径 | ✅ 路径示例  | `./output/{category}/file.md` |
| 实现逻辑 | ❌ 不需要    | 让 AI 推理                    |
| 完整脚本 | ❌ 不需要    | -                             |

---

## 智能体提示词标准模板

### Frontmatter（必需）

```yaml
---
description: 简短描述（一句话）
mode: subagent | main
temperature: 0.1 | 0.2
maxSteps: 数字
hidden: true | false（可选）
---
```

**示例**：

```yaml
---
description: 报告组装器 - 组装各部分为最终报告
mode: subagent
temperature: 0.1
maxSteps: 20
hidden: true
---
```

### 正文结构（必需）

```markdown
# {智能体名称}

你是{角色}，负责{核心任务}。

## 核心职责

1. 职责1
2. 职责2
3. 职责3

## 输入参数

从 prompt 中提取：

- param1: 说明
- param2: 说明

## 工作流程

### 1. 步骤名称

简短说明。

**关键点**：

- 要点1
- 要点2

### 2. 下一步骤

...

## 输出要求

返回JSON包含：

- field1: 说明
- field2: 说明

## 可用工具

- `tool_name` - 说明
- `@agent_name` - 说明

## 关键原则

1. **原则1** - 说明
2. **原则2** - 说明

## 错误处理

- 错误场景 → 处理方式
- 错误场景 → 处理方式
```

---

## 项目特定规则

### Session ID 管理

**只有 `coordinator.md` 可以生成 session_id**

其他所有智能体：

- ✅ 从 prompt 参数中获取 session_id
- ❌ 禁止自己生成 session_id
- ❌ 禁止使用随机字符串或时间戳

**标准写法**：

```markdown
## 关键原则

1. **session_id管理** - 从prompt参数获取，禁止自己生成
```

### 并行执行

**多个独立任务必须并行执行**

```markdown
### 3. 并行启动分析任务

同时启动三个分析任务（并行执行）：

- @agent1
- @agent2
- @agent3
```

### 数据验证

**每个关键步骤后必须验证数据**

```markdown
### 2. 数据检查

**搜索后验证**：

- 有结果 → 继续
- 无结果 → 返回 no_data，终止任务
```

### 错误处理模式

**统一使用简洁的箭头格式**

```markdown
## 错误处理

- 场景1 → 处理方式1
- 场景2 → 处理方式2
- 场景3 → 处理方式3
```

---

## 常见错误和避免方法

### 错误 1：过度解释

❌ **不好**：

```markdown
## 关于搜索功能的详细说明

搜索是我们系统的核心功能之一。当用户请求搜索时，我们需要...

（300字的详细说明）
```

✅ **好**：

```markdown
### 1. 搜索新闻

使用 `web-browser_multi_search_tool` 搜索：

- num_results: 5-10
- search_type: "news"
```

### 错误 2：重复定义

❌ **不好** - 在多个文件中重复：

```markdown
## 报告格式

# {event_name}

**生成时间**：{timestamp}
**类别**：{category}

---

## 📋 事件摘要

{summary}

---

## 📰 新闻来源

{news}
...
```

✅ **好** - 引用模板：

```markdown
## 输出要求

使用 `templates/event-report-template.md` 作为模板，填充各部分内容。
```

### 错误 3：过多的代码示例

❌ **不好**：

````markdown
## Python 实现示例

```python
def extract_filename(path):
    # 50行完整实现
    ...

def process_content(content):
    # 30行完整实现
    ...

# 总共 150 行代码
```
````

````

✅ **好**：

```markdown
## 修正图片路径

- 从路径中提取文件名
- 改为相对路径：`./{event_name}/{filename}`
- 验证文件是否存在
````

---

## 提示词优化检查清单

在提交新的智能体提示词前，请确认：

### 结构检查

- [ ] 包含 frontmatter（description, mode, temperature, maxSteps）
- [ ] 包含核心职责（3-7项）
- [ ] 包含输入参数说明
- [ ] 包含工作流程（步骤清晰）
- [ ] 包含输出要求
- [ ] 包含可用工具列表
- [ ] 包含关键原则（最重要规则）
- [ ] 包含错误处理

### 内容检查

- [ ] 总行数 < 200 行
- [ ] 没有冗长的代码示例
- [ ] 没有重复的场景说明
- [ ] 使用模板引用而非重复定义
- [ ] session_id 管理规则正确（如适用）
- [ ] 并行执行要求明确（如适用）
- [ ] 数据验证步骤完整

### 格式检查

- [ ] Markdown 语法正确
- [ ] 列表前后有空行
- [ ] 代码块语言标识正确
- [ ] 标题层级正确（# ## ###）

---

## 示例对比

### 优化前（757 行）

包含：

- 大量 Python 代码示例（200+ 行）
- 重复的场景说明（3-4 个相似示例）
- 冗余的错误处理 JSON 示例
- 详细的正则表达式说明
- 完整的合并脚本

### 优化后（114 行）

包含：

- 核心职责（6 项）
- 简洁的工作流程（4 个步骤）
- 关键修正规则（4 类）
- 清晰的成功标准（5 项）
- 简短的错误处理（3 种）

**减少 85% 的行数，保留所有关键信息**

---

## 总结

好的智能体提示词应该：

1. **简洁** - 控制在 100-200 行
2. **清晰** - 每个部分职责明确
3. **引用** - 使用模板避免重复
4. **聚焦** - 描述"做什么"而非"怎么做"
5. **验证** - 包含数据验证和错误处理

遵循这些原则，可以让智能体：

- 更快地理解任务
- 更准确地执行指令
- 更容易维护和更新
