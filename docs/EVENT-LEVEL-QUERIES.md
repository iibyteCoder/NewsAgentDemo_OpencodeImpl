# 事件级别查询功能说明

## 概述

系统现在支持**两种查询模式**，可以根据用户需求灵活处理：

1. **广泛模式（大类查询）**：搜索整个类别，处理所有事件
2. **精确模式（具体事件查询）**：精确定位特定事件，只处理相关内容

---

## 查询模式对比

### 广泛模式

**适用场景**：
- 想要了解某个领域的整体动态
- 浏览某个类别的所有重要事件
- 没有特定目标，进行探索性搜索

**示例**：
```
输入：国际政治
结果：获取国际政治领域的所有事件（美国大选、中东局势、欧洲经济等）
```

**特点**：
- ✅ 覆盖面广，获取全面信息
- ❌ 信息量大，可能包含不相关内容
- 📊 适合：概览、探索

---

### 精确模式

**适用场景**：
- 关注特定事件的发展
- 需要深入了解某个具体事件
- 已经知道想要查询的内容

**示例**：
```
输入：国际政治中的美国大选
结果：只获取与美国大选相关的事件和新闻
```

**特点**：
- ✅ 精准聚焦，信息高度相关
- ✅ 节省处理资源，提高效率
- 📊 适合：深度分析、跟踪特定事件

---

## 查询语法

### 1. 纯类别查询（广泛模式）

```text
{类别}
```

**示例**：
- "国际政治"
- "体育新闻"
- "科技资讯"

---

### 2. 类别+事件查询（精确模式）⭐

#### 语法A：使用"中的"

```text
{类别}中的{具体事件}
```

**示例**：
- "国际政治中的美国大选"
- "体育新闻中的NBA总决赛"
- "科技领域的GPT-5发布"

#### 语法B：使用"关于"

```text
关于{具体事件}的{类别}
```

**示例**：
- "关于美国大选的国际政治"
- "关于NBA的体育新闻"

#### 语法C：使用"下"

```text
{类别}下的{具体事件}
```

**示例**：
- "国际政治下的美国大选"
- "体育下的NBA比赛"

---

### 3. 纯事件查询（自动推断类别）

```text
{具体事件}
```

系统会根据事件关键词自动推断最可能的类别。

**示例**：
- "美国大选" → 推断为"政治"类别
- "NBA总决赛" → 推断为"体育"类别
- "GPT-5发布" → 推断为"科技"类别

---

## 处理流程

### Coordinator 层面

```python
# 步骤1：解析用户输入
query = "国际政治中的美国大选"

# 步骤2：识别查询模式
if "中的" in query or "下的" in query:
    mode = "specific"
    category = "国际政治"
    specific_events = ["美国大选"]
else:
    mode = "broad"
    category = "国际政治"
    specific_events = None

# 步骤3：调用 category-processor
@category-processor(
    category=category,
    specific_events=specific_events,
    session_id=session_id,
    report_timestamp=report_timestamp
)
```

### Category-Processor 层面

```python
# 步骤1：接收参数
if specific_events:
    # 精确模式
    query_mode = "specific"
    search_queries = specific_events
else:
    # 广泛模式
    query_mode = "broad"
    search_queries = [category]

# 步骤2：执行搜索
for query in search_queries:
    results = web-browser_multi_search_tool(query=query, num_results=30)

# 步骤3：聚合事件
events = event-aggregator(results)

# 步骤4：事件过滤（仅精确模式）
if query_mode == "specific":
    filtered = filter_events(events, specific_events)
else:
    filtered = events  # 处理所有事件

# 步骤5：并发处理
for event in filtered:
    @event-processor(event)
```

---

## 实际使用示例

### 示例1：大类查询

```bash
# 用户输入
"收集今日国际政治新闻"

# 系统处理
category = "国际政治"
specific_events = None
mode = "broad"

# 搜索关键词
["国际政治"]

# 处理事件
[美国大选民调, 中东局势, 欧洲经济会议, 亚太合作, ...]
# 结果：处理10个事件
```

---

### 示例2：具体事件查询

```bash
# 用户输入
"收集国际政治中的美国大选新闻"

# 系统处理
category = "国际政治"
specific_events = ["美国大选"]
mode = "specific"

# 搜索关键词
["美国大选", "国际政治 美国大选"]

# 处理事件（过滤后）
[美国大选民调, 美国大选辩论, 美国大选候选人]
# 结果：只处理3个相关事件
```

---

### 示例3：混合查询

```bash
# 用户输入
"收集科技新闻和体育新闻中的NBA"

# 系统处理
categories_info = [
    {
        "category": "科技",
        "specific_events": None,  # 广泛模式
        "mode": "broad"
    },
    {
        "category": "体育",
        "specific_events": ["NBA"],  # 精确模式
        "mode": "specific"
    }
]

# 科技类别
搜索：["科技"]
处理：所有科技事件（AI、芯片、手机、...）

# 体育类别
搜索：["NBA", "体育 NBA"]
处理：只处理NBA相关事件（NBA总决赛、NBA交易、...）
```

---

## 性能对比

| 指标 | 广泛模式 | 精确模式 |
|------|---------|---------|
| 搜索时间 | 1次搜索 | 1-2次搜索（更精确） |
| 获取新闻数 | 30-50条 | 30-50条（高度相关） |
| 事件数量 | 8-15个 | 2-5个（聚焦） |
| 处理时间 | 较长 | 较短 |
| 信息相关性 | 中等 | 高 |
| 覆盖面 | 广 | 窄而深 |

---

## 最佳实践

### 何时使用广泛模式？

- ✅ 早上新闻浏览，了解"今日要闻"
- ✅ 研究某个领域，需要全面信息
- ✅ 不确定具体想看什么，进行探索
- ✅ 需要生成综合性报告

### 何时使用精确模式？

- ✅ 跟踪某个持续发展的特定事件（如美国大选）
- ✅ 只对某个子话题感兴趣（如NBA而不是所有体育）
- ✅ 需要快速获取特定事件的最新进展
- ✅ 已经有明确目标，不想浪费时间处理无关内容

---

## 技术实现

### 关键文件修改

1. **[prompts/coordinator.md](../prompts/coordinator.md)**
   - 增加事件级别识别逻辑
   - 支持三种查询模式解析
   - 传递 `specific_events` 参数

2. **[prompts/category-handler.md](../prompts/category-handler.md)**
   - 接收 `specific_events` 参数
   - 实现事件过滤逻辑
   - 根据模式调整搜索策略

### 参数传递链路

```
用户输入
  ↓
Coordinator (解析查询模式)
  ├─ category
  └─ specific_events (可选)
  ↓
Category-Processor (执行搜索和过滤)
  ├─ search_queries (根据模式调整)
  └─ events_to_process (过滤后)
  ↓
Event-Processor (并发处理)
  └─ 生成事件报告
```

---

## 向后兼容性

✅ **完全向后兼容**：

- 如果用户不指定具体事件，系统默认使用广泛模式
- 现有的调用方式不受影响
- 所有现有功能保持不变

---

## 未来扩展

可能的增强方向：

1. **多事件组合查询**：
   ```
   "国际政治中的美国大选和中东局势"
   specific_events = ["美国大选", "中东局势"]
   ```

2. **时间范围过滤**：
   ```
   "本周的国际政治新闻"
   ```

3. **智能推荐**：
   ```
   用户：国际政治
   系统：检测到以下热点事件...
   ```

4. **事件间关联分析**：
   ```
   "分析美国大选对中东局势的影响"
   ```

---

## 总结

通过引入**事件级别查询**，系统现在可以：

- 🎯 **更精准**：根据用户需求调整搜索范围
- ⚡ **更高效**：避免处理无关事件
- 🔄 **更灵活**：支持广泛浏览和深度分析
- ✅ **兼容性**：保持所有现有功能

用户体验提升：
- 想看大类？→ 直接查询类别
- 想看具体事件？→ 使用"类别中的事件"语法
- 系统自动理解并适配查询意图
