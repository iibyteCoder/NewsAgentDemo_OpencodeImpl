# æ™ºèƒ½ä½“ç³»ç»Ÿå¿«é€Ÿå‚è€ƒ

## æ–°æ¶æ„æ¦‚è§ˆ

```
Orchestrator (Primary)
  â†“ å¹¶å‘å¯åŠ¨å¤šä¸ª Category-Processor
Category-Processor (Subagent) Ã— N
  â†“ ä¸ºæ¯ä¸ªäº‹ä»¶å¯åŠ¨ Event-Processor
Event-Processor (Subagent) Ã— N
  â†“ å¹¶å‘å¯åŠ¨ä¸‰ä¸ªåˆ†æ
Validator + Timeline-Builder + Predictor (Subagents)
  â†“
Synthesizer (Subagent)
```

## ä½¿ç”¨æ–¹æ³•

### 1. åˆ‡æ¢åˆ° Orchestrator

åœ¨VSCodeä¸­ï¼š
- ä½¿ç”¨å¿«æ·é”® `Tab` æˆ–é…ç½®çš„ `switch_agent` é”®
- é€‰æ‹© `orchestrator`

### 2. è¾“å…¥æŒ‡ä»¤

```text
# å•ä¸ªç±»åˆ«
æ”¶é›†ä½“è‚²æ–°é—»

# å¤šä¸ªç±»åˆ«ï¼ˆBçº§éœ€æ±‚ï¼‰
æ”¶é›†ä½“è‚²å’Œæ”¿æ²»æ–°é—»

# æ›´å¤šç±»åˆ«
æ”¶é›†ç§‘æŠ€ã€ç»æµã€å¨±ä¹æ–°é—»
```

### 3. ç­‰å¾…å®Œæˆ

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- åˆ†è§£éœ€æ±‚ä¸ºç±»åˆ«
- å¹¶å‘å¤„ç†æ‰€æœ‰ç±»åˆ«
- ç”ŸæˆæŠ¥å‘Šå’Œæ€»ç´¢å¼•

## å…³é”®æ”¹è¿›

### âœ… è§£å†³çš„é—®é¢˜

1. **å¤šç±»åˆ«å¡ä½**ï¼šæ˜ç¡®ä½¿ç”¨ `subagent_type`ï¼Œé¿å…Taskè¢«åˆ†é…ç»™general
2. **æ€§èƒ½æå‡**ï¼šä¸‰å±‚å¹¶å‘ï¼Œæ˜¾è‘—åŠ é€Ÿ
3. **æ¶æ„æ¸…æ™°**ï¼šèŒè´£æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤

### ğŸš€ æ€§èƒ½æå‡

- **å•ç±»åˆ«**ï¼šä¸ä¹‹å‰ç›¸åŒ
- **å¤šç±»åˆ«**ï¼šç†è®ºåŠ é€Ÿæ¯” = ç±»åˆ«æ•° Ã— äº‹ä»¶æ•°
- **ç¤ºä¾‹**ï¼š3ä¸ªç±»åˆ« Ã— 5ä¸ªäº‹ä»¶ = 15å€åŠ é€Ÿ

## Agenté…ç½®

### Orchestrator (Primary)

**æ–‡ä»¶**ï¼š[.opencode/agents/orchestrator.md](../.opencode/agents/orchestrator.md)

**èŒè´£**ï¼š
- åˆ†è§£ç”¨æˆ·éœ€æ±‚ä¸ºç±»åˆ«
- å¹¶å‘å¯åŠ¨å¤šä¸ª Category-Processor
- ç”Ÿæˆæ€»ç´¢å¼•

**ä¸æ‰§è¡Œ**ï¼šå…·ä½“çš„æ–°é—»æ”¶é›†ã€åˆ†æä»»åŠ¡

### Category-Processor (Subagent)

**æ–‡ä»¶**ï¼š[.opencode/agents/category-processor.md](../.opencode/agents/category-processor.md)

**èŒè´£**ï¼š
- å¤„ç†å•ä¸ªç±»åˆ«çš„å®Œæ•´æµç¨‹
- æœç´¢æ–°é—» â†’ èšåˆäº‹ä»¶ â†’ å¤„ç†äº‹ä»¶ â†’ ç”ŸæˆæŠ¥å‘Š

**è¢«è°ƒç”¨æ–¹å¼**ï¼š
```python
Task(
    description="å¤„ç†ä½“è‚²ç±»åˆ«",
    subagent_type="category-processor",  # å…³é”®å‚æ•°
    prompt="å¤„ç†ç±»åˆ«ï¼šä½“è‚²"
)
```

### Event Subagents (Hidden)

**ä¿æŒä¸å˜**ï¼Œç»§ç»­ä½¿ç”¨ï¼š

- `event-aggregator`ï¼šèšåˆæ–°é—»ä¸ºäº‹ä»¶
- `event-processor`ï¼šå¤„ç†å•ä¸ªäº‹ä»¶ï¼ˆå¹¶å‘è°ƒç”¨ä¸‰ç§åˆ†æï¼‰
- `validator`ï¼šéªŒè¯äº‹ä»¶çœŸå®æ€§
- `timeline-builder`ï¼šæ„å»ºäº‹ä»¶æ—¶é—´è½´
- `predictor`ï¼šé¢„æµ‹äº‹ä»¶å‘å±•è¶‹åŠ¿
- `synthesizer`ï¼šç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š

## å¸¸è§ä»»åŠ¡ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ”¶é›†ä½“è‚²æ–°é—»

```text
å¸®æˆ‘æ”¶é›†ä½“è‚²è¿åŠ¨ç›¸å…³æ–°é—»
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. Orchestratorè¯†åˆ«ç±»åˆ«ï¼š["ä½“è‚²"]
2. å¯åŠ¨1ä¸ªCategory-Processor
3. Category-Processoræ‰§è¡Œï¼š
   - æœç´¢ä»Šæ—¥ä½“è‚²æ–°é—»
   - èšåˆä¸ºäº‹ä»¶
   - å¹¶å‘å¤„ç†æ‰€æœ‰äº‹ä»¶
   - ç”ŸæˆæŠ¥å‘Š

### ç¤ºä¾‹2ï¼šæ”¶é›†å¤šç±»åˆ«æ–°é—»ï¼ˆBçº§éœ€æ±‚ï¼‰

```text
å¸®æˆ‘æ”¶é›†ä½“è‚²è¿åŠ¨å’Œå›½é™…æ”¿æ²»ç›¸å…³æ–°é—»
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. Orchestratorè¯†åˆ«ç±»åˆ«ï¼š["ä½“è‚²", "æ”¿æ²»"]
2. **å¹¶å‘å¯åŠ¨**2ä¸ªCategory-Processor
3. ä¸¤ä¸ªCategory-Processor**åŒæ—¶æ‰§è¡Œ**ï¼š
   - ä½“è‚²ï¼šæœç´¢â†’èšåˆâ†’å¤„ç†â†’ç”ŸæˆæŠ¥å‘Š
   - æ”¿æ²»ï¼šæœç´¢â†’èšåˆâ†’å¤„ç†â†’ç”ŸæˆæŠ¥å‘Š
4. ç”Ÿæˆæ€»ç´¢å¼•

### ç¤ºä¾‹3ï¼šå¤æ‚éœ€æ±‚

```text
æ”¶é›†ç§‘æŠ€ã€ç»æµã€å¨±ä¹ã€ä½“è‚²æ–°é—»
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. è¯†åˆ«4ä¸ªç±»åˆ«
2. **å¹¶å‘å¯åŠ¨**4ä¸ªCategory-Processor
3. **åŒæ—¶å¤„ç†**4ä¸ªç±»åˆ«çš„å®Œæ•´æµç¨‹
4. ç”Ÿæˆæ€»ç´¢å¼•

**æ€§èƒ½**ï¼š4ä¸ªç±»åˆ«åŒæ—¶å¤„ç†ï¼Œç†è®ºåŠ é€Ÿæ¯”4Ã—ï¼ˆæ¯ä¸ªç±»åˆ«çš„äº‹ä»¶æ•°ï¼‰

## å…³é”®æŠ€æœ¯ç‚¹

### 1. æ˜ç¡®æŒ‡å®šSubagent

**æ­£ç¡®** âœ…ï¼š
```python
Task(
    description="å¤„ç†ä½“è‚²ç±»åˆ«",
    subagent_type="category-processor",  # æ˜ç¡®æŒ‡å®š
    prompt="å¤„ç†ç±»åˆ«ï¼šä½“è‚²"
)
```

**é”™è¯¯** âŒï¼š
```python
Task(
    description="å¤„ç†ä½“è‚²ç±»åˆ«",
    prompt="å¤„ç†ç±»åˆ«ï¼šä½“è‚²"  # ç¼ºå°‘subagent_type
)
```

### 2. å¹¶å‘å¯åŠ¨Task

**æ­£ç¡®** âœ…ï¼š
```python
# åŒæ—¶å¯åŠ¨æ‰€æœ‰Taskï¼ˆå¹¶å‘æ‰§è¡Œï¼‰
for category in categories:
    Task(
        description=f"å¤„ç†{category}",
        subagent_type="category-processor",
        prompt=f"å¤„ç†ç±»åˆ«ï¼š{category}"
    )
```

**é”™è¯¯** âŒï¼š
```python
# ä¸²è¡Œå¯åŠ¨
for category in categories:
    task = Task(...)
    result = task.result  # ç­‰å¾…å®Œæˆ
```

### 3. æœ€å°ä¸Šä¸‹æ–‡

**æ­£ç¡®** âœ…ï¼š
```python
Task(
    description="å¤„ç†äº‹ä»¶",
    subagent_type="event-processor",
    prompt="å¤„ç†äº‹ä»¶:'äº‹ä»¶åç§°'"  # åªä¼ é€’åç§°
)
```

**é”™è¯¯** âŒï¼š
```python
Task(
    description="å¤„ç†äº‹ä»¶",
    prompt=f"""
    å¤„ç†äº‹ä»¶ï¼Œæ•°æ®å¦‚ä¸‹ï¼š
    {å¤§é‡æ•°æ®}
    """  # ä¼ é€’å¤§é‡ä¸Šä¸‹æ–‡
)
```

## é…ç½®æ–‡ä»¶

### opencode.json

æ–°å¢é…ç½®ï¼š

```json
{
  "agent": {
    "orchestrator": {
      "mode": "primary",
      "description": "æ–°é—»æ”¶é›†ç¼–æ’å™¨",
      "prompt": "{file:.opencode/agents/orchestrator.md}",
      "permission": {
        "task": {
          "category-processor": "allow"
        }
      }
    },
    "category-processor": {
      "mode": "subagent",
      "description": "ç±»åˆ«å¤„ç†å™¨",
      "prompt": "{file:.opencode/agents/category-processor.md}",
      "permission": {
        "task": {
          "event-aggregator": "allow",
          "event-processor": "allow",
          "synthesizer": "allow"
        }
      }
    }
  }
}
```

## è¾“å‡ºç»“æ„

```
output/report_YYYYMMDD_HHMMSS/
â”œâ”€â”€ ä½“è‚²/
â”‚   â””â”€â”€ 2026-01-29/
â”‚       â””â”€â”€ èµ„è®¯æ±‡æ€»ä¸æ‘˜è¦/
â”‚           â”œâ”€â”€ index.md
â”‚           â”œâ”€â”€ äº‹ä»¶1.md
â”‚           â”œâ”€â”€ äº‹ä»¶1/
â”‚           â”‚   â”œâ”€â”€ å›¾ç‰‡1.png
â”‚           â”‚   â””â”€â”€ å›¾ç‰‡2.png
â”‚           â””â”€â”€ ...
â”œâ”€â”€ æ”¿æ²»/
â”‚   â””â”€â”€ 2026-01-29/
â”‚       â””â”€â”€ èµ„è®¯æ±‡æ€»ä¸æ‘˜è¦/
â”‚           â””â”€â”€ ...
â””â”€â”€ æ€»ç´¢å¼•.md
```

## è¿ç§»æŒ‡å—

### ä» news-collector è¿ç§»åˆ° orchestrator

1. **åˆ‡æ¢agent**ï¼šåœ¨VSCodeä¸­åˆ‡æ¢åˆ°orchestrator
2. **ä½¿ç”¨æ–¹å¼ä¸å˜**ï¼šè¾“å…¥åŒæ ·çš„è‡ªç„¶è¯­è¨€æŒ‡ä»¤
3. **æ€§èƒ½æå‡**ï¼šå¤šç±»åˆ«æŸ¥è¯¢é€Ÿåº¦æ˜¾è‘—æå‡
4. **é—®é¢˜ä¿®å¤**ï¼šä¸å†å‡ºç°å¡ä½é—®é¢˜

### å…¼å®¹æ€§

- âœ… `news-collector` ä¿ç•™ï¼ˆæ ‡è®°ä¸ºå·²å¼ƒç”¨ï¼‰
- âœ… æ‰€æœ‰event subagentä¿æŒä¸å˜
- âœ… è¾“å‡ºæ ¼å¼ä¿æŒä¸€è‡´
- âœ… æ•°æ®åº“schemaä¿æŒä¸å˜

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå¤šç±»åˆ«æ—¶å¡ä½

**åŸå› **ï¼šTaskè¢«åˆ†é…ç»™general agent

**è§£å†³**ï¼šç¡®ä¿ä½¿ç”¨ `subagent_type` å‚æ•°
```python
Task(
    subagent_type="category-processor",  # å¿…é¡»æŒ‡å®š
    ...
)
```

### é—®é¢˜2ï¼šæœç´¢åˆ°å†å²æ–°é—»

**åŸå› **ï¼šæœç´¢è¯æ²¡æœ‰åŒ…å«"ä»Šæ—¥"æˆ–å…·ä½“æ—¥æœŸ

**è§£å†³**ï¼šä½¿ç”¨åŒ…å«æ—¥æœŸçš„æœç´¢è¯
```python
query = f"{category}æ–°é—» {today}"  # åŒ…å«ä»Šæ—¥æ—¥æœŸ
```

### é—®é¢˜3ï¼šäº‹ä»¶å¤„ç†ä¸²è¡Œæ‰§è¡Œ

**åŸå› **ï¼šåœ¨Taskå®Œæˆåæ‰å¯åŠ¨ä¸‹ä¸€ä¸ª

**è§£å†³**ï¼šåŒæ—¶å¯åŠ¨æ‰€æœ‰Taskï¼Œä¸è¦ç­‰å¾…
```python
for event in events:
    Task(...)  # åŒæ—¶å¯åŠ¨
# ä¸è¦åœ¨å¾ªç¯ä¸­ç­‰å¾…ç»“æœ
```

## ç›¸å…³æ–‡æ¡£

- [æ™ºèƒ½ä½“æ¶æ„ä¼˜åŒ–è¯´æ˜.md](æ™ºèƒ½ä½“æ¶æ„ä¼˜åŒ–è¯´æ˜.md) - è¯¦ç»†çš„ä¼˜åŒ–è¯´æ˜
- [../.opencode/agents/orchestrator.md](../.opencode/agents/orchestrator.md) - Orchestratoré…ç½®
- [../.opencode/agents/category-processor.md](../.opencode/agents/category-processor.md) - Category-Processoré…ç½®
- [docs/opencode_docs/agents.mdx](../opencode_docs/agents.mdx) - OpenCode Agentæ–‡æ¡£

## å¿«é€Ÿå¼€å§‹

```bash
# 1. åˆ‡æ¢åˆ°orchestrator agent
åœ¨VSCodeä¸­: Tabé”® â†’ é€‰æ‹©orchestrator

# 2. è¾“å…¥æŒ‡ä»¤
"å¸®æˆ‘æ”¶é›†ä½“è‚²å’Œæ”¿æ²»æ–°é—»"

# 3. ç­‰å¾…å®Œæˆ
ç³»ç»Ÿè‡ªåŠ¨å¹¶å‘å¤„ç†ä¸¤ä¸ªç±»åˆ«

# 4. æŸ¥çœ‹æŠ¥å‘Š
output/report_YYYYMMDD_HHMMSS/
```

---

**æç¤º**ï¼šæ‰€æœ‰agenté…ç½®æ–‡ä»¶éƒ½åœ¨ `.opencode/agents/` ç›®å½•ä¸‹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ã€‚
