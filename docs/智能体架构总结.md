# 新闻资讯收集系统 - 智能体架构总结

## 文档信息

| 项目 | 内容 |
|------|------|
| **更新日期** | 2026-01-29 |
| **架构类型** | 事件驱动的多智能体协作 |
| **目标等级** | S级（包含C/B/A级所有功能） |
| **配置状态** | ✅ 已完成并通过验证 |

---

## 一、核心概念理解

### 1.1 关键纠正

**之前错误的实现**：
```
新闻链接(URL) → 去重(URL) → 验证(URL) → 时间轴(URL) → 预测(URL)
```

**正确的实现**（事件驱动）：
```
多个新闻链接 → 聚合为"事件" → 验证(事件) → 时间轴(事件) → 预测(事件)
     ↓              ↓              ↓              ↓            ↓
  原始数据      事件聚合       多轮搜索验证    主动填补缺口   多维度分析
```

### 1.2 核心概念

| 概念 | 定义 | 示例 |
|------|------|------|
| **NewsLink** | 单个新闻URL | `https://cnn.com/trump-iowa` |
| **NewsEvent** ⭐ | 多个URL报道同一件事的聚合 | "特朗普赢得艾奥瓦初选" = CNN+Fox+Reuters |
| **Topic** | 多个相关事件的集合 | "美国大选" = 宣布参选+初选+辩论+... |

**关键点**：一个 `NewsEvent` 包含 2-5 个 `NewsLink`，后续所有分析都针对"事件"而非单个URL。

---

## 二、智能体架构设计

### 2.1 整体架构图

```
用户输入："收集体育运动和国际政治相关新闻"
    ↓
┌──────────────────────────────────────────────────────┐
│  主 Agent: news-collector (任务协调)                  │
│  - 理解用户需求                                        │
│  - 协调各阶段执行                                      │
│  - 管理 subagent 调用                                 │
└──────────────┬───────────────────────────────────────┘
               ↓
┌──────────────────────────────────────────────────────┐
│  阶段1: 收集 (Collect)                                │
│  ├─ Searcher (体育)    → 10个URL                     │
│  ├─ Searcher (政治)    → 10个URL                     │
│  └─ Fetcher (并行)     → 获取内容                    │
│  输出: 20个 NewsLink                                │
└──────────────┬───────────────────────────────────────┘
               ↓
┌──────────────────────────────────────────────────────┐
│  阶段2: 聚合 (Aggregate) ⭐ 核心阶段                  │
│  EventAggregator Agent                                │
│  - 分析相似度                                         │
│  - 聚合为事件（多个URL → 1个事件）                    │
│  - 生成统一标题和摘要                                 │
│  输出: 6-8个 NewsEvent（每个包含2-5个来源）          │
└──────────────┬───────────────────────────────────────┘
               ↓
┌──────────────────────────────────────────────────────┐
│  阶段3-5: 深度分析（针对每个事件并行）⭐ S级核心      │
│                                                       │
│  事件1          事件2          事件3                │
│   ├─ Validator   ├─ Validator   ├─ Validator        │
│   ├─ Timeline    ├─ Timeline    ├─ Timeline         │
│   └─ Predictor   └─ Predictor   └─ Predictor        │
│                                                       │
│  （每个事件独立并行处理）                              │
│  输出: validation + timeline + prediction             │
└──────────────┬───────────────────────────────────────┘
               ↓
┌──────────────────────────────────────────────────────┐
│  阶段6: 报告生成 (Report)                             │
│  Synthesizer Agent                                    │
│  - 按类型组织（体育、政治）                           │
│  - 生成每个事件的MD文件                               │
│  - 生成索引和汇总                                     │
└──────────────────────────────────────────────────────┘
```

### 2.2 智能体列表

| Agent | 类型 | 职责 | 关键特性 |
|-------|------|------|----------|
| **news-collector** | Primary | 任务协调、流程管理 | 一键式、自主协调 |
| **event-aggregator** | Subagent | 聚合URL为事件 | 相似度分析、多源综合 |
| **validator** | Subagent | 验证事件真实性 | 主动探索、多轮搜索、证据链 |
| **timeline-builder** | Subagent | 构建事件时间轴 | 主动填补缺口、完整脉络 |
| **predictor** | Subagent | 预测事件发展 | 多情景预测、风险评估 |
| **synthesizer** | Subagent | 生成最终报告 | 结构化输出、可追溯 |

---

## 三、工作流程详解

### 3.1 阶段1：收集 (Collect)

**目标**：获取原始新闻链接

**处理**：
- 并行搜索多个关键词（体育、政治）
- 每个类型获取 10 个 URL
- 并行获取完整内容

**输出示例**：
```json
{
  "news_links": [
    {
      "url": "https://cnn.com/...",
      "title": "Trump wins Iowa caucus",
      "content": "前总统特朗普在周一赢得了...",
      "source": "CNN",
      "published_at": "2024-01-15",
      "category": "国际政治"
    },
    // ... 共20条
  ]
}
```

### 3.2 阶段2：聚合 (Aggregate) ⭐

**目标**：将多个URL聚合为"事件"

**核心逻辑**：
1. 分析相似度（哪些新闻在讲同一件事？）
2. 聚合为事件（多个URL → 1个事件）
3. 生成统一标题和摘要（综合多个来源）
4. 保留所有来源URL作为证据

**输出示例**：
```json
{
  "events": [
    {
      "id": "event_001",
      "title": "特朗普赢得艾奥瓦州共和党初选",
      "summary": "在1月15日举行的艾奥瓦州共和党初选中，前总统特朗普以显著优势获胜...",
      "category": "国际政治",
      "sources": [
        {"url": "https://cnn.com/...", "title": "Trump wins Iowa", "source": "CNN"},
        {"url": "https://fox.com/...", "title": "特朗普胜出艾奥瓦", "source": "Fox News"},
        {"url": "https://reuters.com/...", "title": "Iowa caucus results", "source": "Reuters"}
      ]
    }
    // ... 共6-8个事件
  ]
}
```

### 3.3 阶段3：验证 (Validate) ⭐

**目标**：验证每个事件的真实性

**方法**：主动探索型（多轮搜索）

**流程**：
```
初步分析 → 规划验证策略 → 5-8轮搜索验证 → 综合判断
```

**验证策略示例**：
1. 搜索："事件关键词 辟谣"
2. 搜索："事件关键词" 其他来源
3. 搜索："发布媒体" 可信度
4. 验证具体数据
5. ...

**输出示例**：
```json
{
  "credibility_score": 85,
  "confidence_level": "高",
  "evidence_chain": [
    "搜索辟谣：未发现",
    "其他来源：发现3个类似报道",
    "媒体可信度：权威媒体",
    "数据验证：数据一致"
  ],
  "validation_rounds": 5
}
```

### 3.4 阶段4：时间轴 (Timeline) ⭐

**目标**：构建每个事件的发展脉络

**方法**：主动探索型（填补缺口）

**流程**：
```
初步梳理 → 识别缺口 → 5-10轮搜索补充 → 构建完整时间轴
```

**缺口识别**：
- 时间缺口（1月15日到25日之间发生了什么？）
- 深化关键节点（初选的详细过程）
- 探索背景原因（为什么参选？）
- 追踪影响后果（初选结果影响了什么？）

**输出示例**：
```json
{
  "milestones": [
    {
      "date": "2024-01-15",
      "event": "宣布参选",
      "importance": "高",
      "description": "特朗普在社交媒体正式宣布参加2024年大选",
      "sources": ["..."]
    },
    {
      "date": "2024-01-25",
      "event": "赢得艾奥瓦初选",
      "importance": "高",
      "description": "以30%的优势赢得艾奥瓦州共和党初选",
      "sources": ["..."]
    }
  ],
  "causality": "参选 → 初选辩论 → 赢得艾奥瓦 → ...",
  "narrative": "完整的叙事性描述...",
  "research_rounds": 8,
  "gaps_filled": 3
}
```

### 3.5 阶段5：预测 (Predict) ⭐

**目标**：预测每个事件的未来发展

**方法**：主动探索型（多维度研究）

**流程**：
```
分析当前态势 → 规划预测策略 → 5-8轮搜索研究 → 构建多情景预测
```

**研究维度**：
- 历史上类似情况是什么结果？
- 专家们怎么看？
- 有哪些关键因素会影响走势？
- 有哪些风险可能导致预测失败？

**输出示例**：
```json
{
  "scenarios": [
    {
      "name": "基准情景",
      "probability": 0.6,
      "description": "特朗普将赢得共和党提名，但在大选中面临激烈竞争",
      "assumptions": ["经济保持稳定", "没有重大丑闻"]
    },
    {
      "name": "乐观情景",
      "probability": 0.25,
      "description": "特朗普赢得共和党提名并成功连任",
      "assumptions": ["经济强劲", "对手表现不佳"]
    },
    {
      "name": "悲观情景",
      "probability": 0.15,
      "description": "特朗普在初选中失利或因法律问题退出",
      "assumptions": ["法律挑战升级", "支持率下降"]
    }
  ],
  "key_factors": ["经济状况", "法律挑战", "对手表现"],
  "risks": ["法律诉讼", "健康问题", "国际危机"],
  "research_rounds": 6,
  "prediction_horizon": "未来6个月"
}
```

### 3.6 阶段6：报告生成 (Report)

**目标**：生成结构化的Markdown报告

**报告结构**（A级）：
```
report_20260129_153045/
├── 国际政治/
│   ├── 2026-01-29/
│   │   ├── 特朗普赢得艾奥瓦初选.md
│   │   │   ├── 摘要
│   │   │   ├── 来源（3个URL）
│   │   │   ├── 真实性验证（85分）
│   │   │   ├── 事件时间轴
│   │   │   └── 趋势预测
│   │   ├── 资讯汇总与摘要.md
│   │   └── index.md
│   └── index.md
├── 体育运动/
│   └── ...
└── index.md
```

---

## 四、配置文件说明

### 4.1 opencode.json

```json
{
  "agent": {
    "news-collector": {
      "mode": "primary",
      "description": "新闻资讯收集智能体 - S级（事件驱动架构）",
      "prompt": "{file:./prompts/news-collector.txt}",
      "permission": {
        "task": {"*": "allow"}  // 关键：允许调用 subagent
      }
    },
    "event-aggregator": {
      "mode": "subagent",
      "prompt": "{file:.opencode/agents/event-aggregator.md}"
    },
    "validator": {
      "mode": "subagent",
      "prompt": "{file:.opencode/agents/validator.md}"
    },
    "timeline-builder": {
      "mode": "subagent",
      "prompt": "{file:.opencode/agents/timeline-builder.md}"
    },
    "predictor": {
      "mode": "subagent",
      "prompt": "{file:.opencode/agents/predictor.md}"
    },
    "synthesizer": {
      "mode": "subagent",
      "prompt": "{file:.opencode/agents/synthesizer.md}"
    }
  }
}
```

**关键点**：
- `task: {"*": "allow"}` 允许主 agent 调用 subagent
- 所有 subagent 的 `mode` 必须是 `"subagent"`
- subagent 的 `prompt` 文件路径必须正确

### 4.2 Prompt 文件结构

```
prompts/
└── news-collector.txt          # 主 agent 提示词

.opencode/agents/
├── event-aggregator.md         # 事件聚合器
├── validator.md                # 事件验证器
├── timeline-builder.md         # 时间轴构建器
├── predictor.md                # 趋势预测器
└── synthesizer.md              # 报告生成器
```

### 4.3 MCP 工具配置

```json
{
  "mcp": {
    "web-browser": {
      "type": "local",
      "command": [".venv/Scripts/python.exe", "mcp_server/web_browser/main.py"],
      "enabled": true
    }
  }
}
```

**可用工具**：
- `baidu_news_search` - 百度新闻搜索
- `baidu_search` - 百度通用搜索
- `fetch_article_content` - 获取文章正文
- `baidu_hot_search` - 百度热搜榜

---

## 五、关键设计决策

### 5.1 为什么采用"事件驱动"？

| 决策 | 理由 |
|------|------|
| **事件作为处理单元** | 符合现实（多个媒体报道同一件事） |
| **聚合多个URL** | 提供完整信息、交叉验证 |
| **针对事件验证** | 验证"这件事"的真假，而非某个URL |
| **针对事件构建时间轴** | 还原"事件"的发展脉络 |
| **针对事件预测** | 预测"事件"的未来走向 |

### 5.2 并行级别选择

**阶段1**：URL级别并行（收集）
- 多个搜索任务并行
- 多个内容获取任务并行

**阶段2**：串行（聚合）
- 需要全局信息来判断相似度

**阶段3-5**：事件级别并行 ⭐
- 每个事件的验证/时间轴/预测并行执行
- 最大化效率

### 5.3 主动探索 vs 被动分析

| 维度 | 被动分析 | 主动探索 ✅ |
|------|---------|----------|
| **信息来源** | 单次搜索 | 多轮搜索（5-10轮） |
| **主动性** | 被动接受 | 主动补充 |
| **深度** | 表面分析 | 深入挖掘 |
| **证据** | 缺乏证据链 | 完整证据链 |
| **可信度** | 低 | 高 |
| **时间** | 快 | 慢（但更可靠） |

**选择**：主动探索型（S级需求）

---

## 六、使用方法

### 6.1 启动 OpenCode

```bash
cd d:\myprojects\PythonProjects\LearningProjects\OpencodeTest_1
opencode
```

### 6.2 切换到 news-collector Agent

按 **Tab** 键切换到 `news-collector` agent

### 6.3 输入需求

```
帮我收集体育运动和国际政治相关新闻
```

或

```
收集美国大选和国际金价相关新闻
```

### 6.4 等待完成

系统会自动完成：
1. ✅ 搜索多个新闻源
2. ✅ 获取新闻内容
3. ✅ 聚合为事件
4. ✅ 验证真实性
5. ✅ 构建时间轴
6. ✅ 预测趋势
7. ✅ 生成报告

**预计时间**：10-20分钟（取决于新闻数量）

---

## 七、验证配置

运行验证脚本：

```bash
python verify_config.py
```

**预期输出**：
```
✅ 所有验证通过！配置正确。
```

---

## 八、需求等级对应

| 等级 | 功能 | 实现方式 |
|------|------|----------|
| **C级** | 基础收集 | 阶段1 |
| **B级** | 多类型并行 + 去重 | 阶段1并行 + 阶段2聚合 |
| **A级** | 智能理解 + 追溯 | 模糊语言理解 + 可追溯性 |
| **S级** | 时间轴 + 预测 | 阶段4 + 阶段5 |

**本架构实现**：S级（包含C/B/A/S所有功能）

---

## 九、核心文件清单

### 配置文件

- [opencode.json](opencode.json) - 主配置文件
- [prompts/news-collector.txt](prompts/news-collector.txt) - 主 Agent 提示词

### Subagent 配置

- [.opencode/agents/event-aggregator.md](.opencode/agents/event-aggregator.md)
- [.opencode/agents/validator.md](.opencode/agents/validator.md)
- [.opencode/agents/timeline-builder.md](.opencode/agents/timeline-builder.md)
- [.opencode/agents/predictor.md](.opencode/agents/predictor.md)
- [.opencode/agents/synthesizer.md](.opencode/agents/synthesizer.md)

### 工具和脚本

- [verify_config.py](verify_config.py) - 配置验证脚本
- [templates/report_structure_template.md](templates/report_structure_template.md) - 报告结构模板

### MCP 服务器

- [mcp_server/web_browser/main.py](mcp_server/web_browser/main.py) - MCP 服务器

---

## 十、总结

### 10.1 核心转变

```
从：URL驱动（以单个链接为处理单元）
到：事件驱动（以聚合的事件为处理单元）
```

### 10.2 关键创新

1. **事件聚合**：多个URL → 一个事件
2. **主动探索**：多轮搜索验证，而非被动分析
3. **事件级别并行**：每个事件独立深度分析
4. **完整证据链**：验证、时间轴、预测都有充分依据

### 10.3 配置状态

✅ **已完成并通过验证**

- 主 agent 配置正确
- 所有 subagent 已声明
- MCP 工具已启用
- 权限配置正确
- 模板文件已创建

**可以开始使用！**

---

**文档版本**: v1.0
**最后更新**: 2026-01-29
**配置状态**: ✅ 已验证
